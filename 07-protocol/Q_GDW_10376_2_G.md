# 路由数据转发类（AFN=00H）

## F1 确认帧数据单元格式

|            D7            |            D6            |            D5            |            D4            |            D3            |            D2            |            D1            |               D0               |
| :----------------------: | :----------------------: | :----------------------: | :----------------------: | :----------------------: | :----------------------: | :----------------------: | :----------------------------: |
| 7信道状态：0为忙；1为闲  | 6信道状态：0为忙；1为闲  | 5信道状态：0为忙；1为闲  | 4信道状态：0为忙；1为闲  | 3信道状态：0为忙；1为闲  | 2信道状态：0为忙；1为闲  | 1信道状态：0为忙；1为闲  | 命令状态：0为未处理；1为已处理 |
| 15信道状态：0为忙；1为闲 | 14信道状态：0为忙；1为闲 | 13信道状态：0为忙；1为闲 | 12信道状态：0为忙；1为闲 | 11信道状态：0为忙；1为闲 | 10信道状态：0为忙；1为闲 | 9信道状态：0为忙；1为闲  |    8信道状态：0为忙；1为闲     |
| 23信道状态：0为忙；1为闲 | 22信道状态：0为忙；1为闲 | 21信道状态：0为忙；1为闲 | 20信道状态：0为忙；1为闲 | 19信道状态：0为忙；1为闲 | 18信道状态：0为忙；1为闲 | 17信道状态：0为忙；1为闲 |    16信道状态：0为忙；1为闲    |
| 31信道状态：0为忙；1为闲 | 30信道状态：0为忙；1为闲 | 29信道状态：0为忙；1为闲 | 28信道状态：0为忙；1为闲 | 27信道状态：0为忙；1为闲 | 26信道状态：0为忙；1为闲 | 25信道状态：0为忙；1为闲 |    24信道状态：0为忙；1为闲    |
|         等待时间         |          高字节          |        （单位S）         |            -             |            -             |            -             |            -             |               -                |
|         等待时间         |          高字节          |        （单位S）         |            -             |            -             |            -             |            -             |               -                |


## F2 否认帧数据单元格式

用一字节表示错误字：

- 0为通信超时；
- 1为无效数据单位；
- 2为长度错；
- 3为校验错误；
- 4为信息类不存在；
- 5为格式错误；
- 6为表号不存在；
- 8为电表应用层无应答；
- 9为主节点忙；
- 10主节点不支持此命令；
- 11从节点不应答；
- 12从节点不在网内；
- 13~108备用；
- 109为超过最大并发数；
- 110超过单个帧最大允许的电表协议报文条数；
- 111正在抄读电表
- 112~255备用



# 数据转发（AFN=02H）

## F1 转发通信协议数据帧

此功能只支持无路由形式，上行报文与下行报文帧格式一致。

| 通信协议类型 | 报文长度 | 报文内容 |
| :----------: | :------: | :------: |
|    1Byte     |  1Byte   |  L Byte  |

1. 通信协议类型：00H为透明传输；01H为DL/T645-1997；02H为DL/T645-2007；03H为DL/T698.45；04H~FFH保留；
2. 报文长度L：通信协议的原始报文数据总长度；
3. 报文内容：通信协议的原始报文数据。


# 路由数据转发类（AFN=13H）

## F1 监控从节点数据单元格式

### 下行报文

| 通信协议类型 | 通信延时相关性标志 | 从节点附属节点数量n | 从节点附属节点1地址 |  ...  | 从节点附属节点n地址 | 报文长度L | 报文内容 |
| :----------: | :----------------: | :-----------------: | :-----------------: | :---: | :-----------------: | :-------: | :------: |
|    1Byte     |       1Byte        |        1Byte        |        6Byte        |  ...  |        6Byte        |   1Byte   |  L Byte  |

1. 通信协议类型：00H为透明传输；01H为DL/T645-1997；02H为DL/T645-2007；03H为DL/T698.45；04H~FFH保留；
2. 通信延时相关性标志：01H代表当前通信的应用数据和本地信道的通信延时相关，需要根据具体的通信延迟时间修正通信数据；00H代表当前通信的应用数据和本地信道的通信延时无关，无需本地通信压实修正具体报文信息；02-FFH保留；
3. 报文长度L：通信协议的原始报文数据总长度；
4. 报文内容：通信协议的原始报文数据。


### 上行报文

| 当前报文本地通信上行时长 | 通信协议类型 | 报文长度L | 报文内容 |
| :----------------------: | :----------: | :-------: | :------: |
|          2Byte           |    1Byte     |   1Byte   |  L Byte  |


1. 当前报文本地通信上行时长：代表当前报文从具体从节点传输到主节点的通信延迟时间，便于集中器进行和通信延迟相关的报文数据中的精确时间信息计算，单位为秒；
2. 通信协议类型：00H为透明传输；01H为DL/T645-1997；02H为DL/T645-2007；03H为DL/T698.45；04H~FFH保留；
3. 报文长度L：通信协议的原始报文数据总长度；
4. 报文内容：通信协议的原始报文数据。


# 路由数据抄读类（AFN=14H）

此接口共有4个数据标识：

1. F1：路由请求抄读内容；
2. F2：路由请求集中器时钟；
3. F3：请求依通信延时修正通信数据；
4. F4：路由请求交采信息。


## F1 路由请求抄读内容数据单元格式

### 上行报文

| 通信相位 | 从节点地址（BCD） | 从节点序号 |
| :------: | :---------------: | :--------: |
|  1Byte   |       6Byte       |   2Byte    |

通信相位：0指未知相位；1-3指第1、2、3相。

### 下行报文


| 抄读标志 | 通信延时相关性标志 | 路由请求数据长度L | 路由请求数据内容 | 从节点附属节点数量n | 从节点附属节点1地址 |  ...  | 从节点附属节点1地址 |
| :------: | :----------------: | :---------------: | :--------------: | :-----------------: | :-----------------: | :---: | :-----------------: |
|  1Byte   |       1Byte        |       1Byte       |      L Byte      |        1Byte        |        6Byte        |  ...  |        6Byte        |

- 抄读标志：00H为抄读失败，L=0，n=0；01为抄读成功，L=0，n=0；02H为可以抄读，L>0，n>=0。
- 通信延时相关性标志：01H代表当前通信的应用数据和本地信道的通信延时相关，后续路由选择具体通信路径时，需要提示集中器根据具体的通信延迟时间修正通信数据；00H代表当前通信的应用数据和本地信道的通信延时无关；02-FFH保留，仅当抄读标志为02H时，该信息有效；
- 路由请求数据长度L：标识为02H时，长度有效，表示数据内容的长度；
- 路由请求数据内容：数据长度L有效时，为DL/T645通信协议的数据。


## F2 路由请求集中器时钟数据单元格式

### 无上行报文

### 下行报文

| 当前时间（秒）BCD | 当前时间（分）BCD | 当前时间（时）BCD | 当前时间（日）BCD | 当前时间（月）BCD |
| :---------------: | :---------------: | :---------------: | :---------------: | :---------------: |
|       1Byte       |       1Byte       |       1Byte       |       1Byte       |       1Byte       |


## F3 请求依通信延时修正通信数据数据单元格式


### 上行报文

| 从节点地址 | 预计延迟时间 | 抄读信息长度L | 抄读数据内容 |
| :--------: | :----------: | :-----------: | :----------: |
|   6Byte    |    2Byte     |     1Byte     |    L Byte    |

- 从节点地址指待通信的目的地址；
- 预计延迟时间指当前要通信的路径环境下，指定报文的预计通信延迟时间，单位为秒；
- 抄读信息长度L指抄读数据内容同“抄读数据内容”的相关定义相同；
- 抄读数据内容：集中器将在此报文基础上依据“预计延迟时间”进行报文精确修正 。

### 下行报文

| 数据长度L | 修正通信数据内容 |
| :-------: | :--------------: |
|   1Byte   |      L Byte      |

- 修正通信数据内容：数据长度L有效时，为DL/T645通信协议的数据，具体内容按照预计通信延迟时间进行了修订，L=0表示放弃本次通信。

## F4 路由请求交采信息数据单元格式

### 上行报文

| 数据项类型 | 交采数据项标识 |
| :--------: | :------------: |
|   1Byte    |     4Byte      |

数据项类型：1代表 DL/T645-2007数据项标识定义；2代表DL/T698.45数据项标识定义；其他取值保留。

### 下行报文

| 数据项类型 | 交采数据项标识 | 交采数据项内容 |
| :--------: | :------------: | :------------: |
|   1Byte    |     4Byte      |     N Byte     |


- 数据项类型：1代表 DL/T645-2007数据项标识定义；2代表DL/T698.45数据项标识定义；其他取值保留。
- 交采数据项标识：随数据项类型取DL/T645-2007数据项标识定义或DL/T698.45数据项标识定义；
- 交采数据项内容：随数据项类型取DL/T645-2007数据项标识对应内容或DL/T698.45数据项标识定义对应内容；


# 路由控制类（AFN=12H）

## F1 路由重启数据单元格式

### 下行报文

无数据单元

### 上行报文

上行报文为确认、否认帧报文。

